{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ post.title }} - TravelSnips</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/landingpage.css' %}">
    <link rel="stylesheet" href="{% static 'css/navbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/post.css' %}">
    <script src="{% static 'js/navbar.js' %}" defer></script>
    <script src="{% static 'js/post-detail.js' %}" defer></script>
</head>
<body>
    <!-- Include the navbar -->
    {% include 'navbar.html' %}
    
    <div class="container post-container">
        <div class="post-header">
            <div class="post-title-container">
                {% if post.post_icon %}
                    <img src="{{ post.post_icon.url }}" alt="{{ post.title }}" class="post-icon">
                {% endif %}
                <div class="post-title-info">
                    <h1>{{ post.title }}</h1>
                    <div class="post-meta">
                        <span class="post-author">By {{ post.owner.username }}</span>
                        <span class="post-date">{{ post.created_at|date:"F j, Y" }}</span>
                    </div>
                </div>
            </div>
            <div class="post-description">
                {{ post.description }}
            </div>
            
            <!-- Associated People Section -->
            <div class="associated-people">
                <h3>People in this Post:</h3>
                <div class="people-list">
                    {% for person in associated_people %}
                        <div class="person-tag">{{ person.username }}</div>
                    {% empty %}
                        <p>No people associated with this post.</p>
                    {% endfor %}
                </div>
                
                {% if is_owner %}
                    <a href="{% url 'manage_associations' post.id %}" class="btn btn-sm">Manage People</a>
                {% endif %}
            </div>
        </div>
        
        <div class="subposts-container">
            {% if subposts %}
                {% for subpost in subposts %}
                    <div class="subpost-card">
                        <h2>{{ subpost.subpost_title }}</h2>
                        <div class="subpost-content">
                            {{ subpost.content|linebreaks }}
                        </div>
                        
                        {% if subpost.images.exists %}
                            <div class="image-gallery">
                                {% for image in subpost.images.all %}
                                    <div class="gallery-item">
                                        <img src="{{ image.image.url }}" alt="{{ image.caption }}">
                                        {% if image.caption %}
                                            <div class="image-caption">{{ image.caption }}</div>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            {% else %}
                <div class="no-subposts">
                    <p>No content has been added to this post yet.</p>
                </div>
            {% endif %}
        </div>
        
        <div class="post-actions">
            <button id="backButton" class="btn btn-secondary">Back to Home</button>
            {% if is_owner %}
                <a href="#" class="btn btn-primary">Add Content</a>
            {% endif %}
        </div>
    </div>

    <!-- Pass URLs to JavaScript -->
    <script>
        // URL variables for JavaScript
        const landingPageUrl = "{% url 'landingpage' %}";
    </script>
</body>
</html>